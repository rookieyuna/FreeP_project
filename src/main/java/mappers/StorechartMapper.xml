<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace ="store.StorechartImpl">

	<select id="getTotalCount" resultType="int" parameterType="util.ParameterDTO">
	   SELECT COUNT(*) FROM store s inner join ordered o 
	   	ON s.b_code=o.b_code
	</select>

	<select id="listPage" resultType="store.StorechartVO" parameterType="util.ParameterDTO">
	 
		SELECT s.b_code, b_name, sum(cp_price) cp_price,
			sum(po_price) po_price, sum(total_price) total_price, to_char(to_date(or_date), 'YYYY-MM')
	    	FROM store s LEFT JOIN ordered o ON s.b_code=o.b_code
			<if test="yearMonth!=null and !yearMonth.equals('')">
			WHERE TO_CHAR(or_date,'YYYY-MM') = #{yearMonth}
				<!-- <if test="location!=null">
					<if test="location == '01'.toString()">
						and #{address} like CONCAT('%', '서울', '%')
					</if>
					<if test="location == '02'.toString()">
						and #{address} like CONCAT('%', '인천', '%')
					</if>
					<if test="searchType == '03'.toString()">
						and address like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '04'.toString()">
						and address like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '05'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '06'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '07'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '08'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '09'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '10'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '11'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '12'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '13'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '14'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '15'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '16'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
					<if test="searchType == '17'.toString()">
						and (title like CONCAT('%', #{keyword}, '%')
							or content like CONCAT('%', #{keyword}, '%')
					</if>
				</if> -->
			</if> 
	    	GROUP BY s.b_code, b_name, to_char(to_date(or_date), 'YYYY-MM')
	       		ORDER BY b_code
	       		
    </select>
	
	
</mapper>
 
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  